<!DOCTYPE html>
<html>
<head>
  <title>Basic example</title>
</head>
<body>
  <script src="../dist/iife.js"></script>
  <script>
    const { Style, HorizontalShape } = wires

    const canvas = document.createElement('canvas')
    const gl = canvas.getContext('webgl')

    class WaveStyle extends Style {
      constructor (gl, { phase = 0 } = {}) {
        super(gl, {
          frag: `
            precision mediump float;
            uniform float phase;
            uniform float length;
            uniform vec3 color;
            varying vec2 uv;

            void main () {
              float alpha = smoothstep(0.95, 1.0, sin(uv.y * 5.0 - 1.0 + sin((uv.x - (phase / length)) * length * 200.0)));
              gl_FragColor = vec4(color, alpha);
              gl_FragColor.rgb *= gl_FragColor.a;
            }
          `
        })

        this.uniforms.phase = gl.getUniformLocation(this.program, 'phase')
        this.phase = phase
      }

      set phase (phase) {
        this.gl.uniform1f(this.uniforms.phase, phase)
      }
    }

    document.body.appendChild(canvas)

    canvas.width = 1000
    canvas.height = 1000
    canvas.style.width = '500px'
    canvas.style.width = '500px'

    gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight)
    gl.enable(gl.BLEND)
    gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA)

    const style = new WaveStyle(gl)

    const shapes = []

    for (let i = 0; i < 10; i++) {
      shapes.push(
        new HorizontalShape({
          width: 0.01,
          from: [0, 0.5],
          to: [1, i / 9]
        })
      )
    }

    function render (time = 0) {
      style.phase = time / 10000

      shapes.forEach(shape => {
        style.draw(shape)
      })

      window.requestAnimationFrame(render)
    }

    render()
  </script>
</body>
</html>
