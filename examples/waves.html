<!DOCTYPE html>
<html>
<head>
  <title>Waves example</title>
</head>
<body>
  <script type="module">
    import { Net, Wire, Shape, Style } from '../dist/esm.js'

    class WaveStyle extends Style.Basic {
      setup (gl) {
        super.setup(gl)
        this.phase = 0
        this.color = [0, 0, 0]
        this.uniformLocations.phase = gl.getUniformLocation(this.program, 'phase')
        this.uniformLocations.color = gl.getUniformLocation(this.program, 'color')
      }

      bindUniforms (context, shape) {
        super.bindUniforms(context, shape)
        context.gl.uniform1f(this.uniformLocations.phase, this.phase)
        context.gl.uniform3fv(this.uniformLocations.color, this.color)
      }
    }

    WaveStyle.frag = `
      precision mediump float;
      uniform float phase;
      uniform float length;
      uniform vec3 color;
      varying vec2 uv;

      void main () {
        float alpha = smoothstep(0.95, 1.0, sin(uv.y * 5.0 - 1.0 + sin((uv.x - (phase / length)) * length / 2.5)));
        gl_FragColor = vec4(color, alpha);
        gl_FragColor.rgb *= gl_FragColor.a;
      }
    `

    const net = new Net()

    net.resize(500, 500)

    const style = new WaveStyle()

    for (let i = 0; i < 10; i++) {
      const shape = new Shape.Horizontal({
        width: 5,
        from: [0, 250],
        to: [500, (i / 9) * 500]
      })

      net.add(new Wire({
        style,
        shape
      }))
    }

    function render (time = 0) {
      style.phase = time / 20
      net.render()
      window.requestAnimationFrame(render)
    }

    render()

    document.body.appendChild(net.canvas)
  </script>
</body>
</html>
